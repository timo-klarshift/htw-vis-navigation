package vis

import vis.lucene.SearchResult
import vis.lucene.Searcher
import vis.lucene.SimpleCallback

class ImageController {
	def searcher = new Searcher(new File("../vis-importer/index/target"))
	def root = new Searcher(new File("../vis-importer/index/index"))

    def index() {
		searcher = new Searcher(new File("../vis-importer/index/target"))
		def sb = new SimpleCallback(0.1)
		searcher.search(params.q ?: 'flower', params.int('max') ?: 20, sb)
		
		def getit = {
			def doc = root.get(it)
			def sr = new SearchResult(doc)
			return [url: sr.url, id: sr.id]
		}	
		
		[results: sb.getResults().collect{[url: it.url, children: it.document.get("children").split(" ").collect{getit(it)}]}]
	}
		
}
